

### 목차 

- [0.공모전 개요](#0-공모전-개요)
- [1. 분석목표 정하기](#1-분석-목표-정하기)
    + [1-1. 사용한 데이터](#1-1-사용한-데이터)
    + [1-2. EDA](#1-2-EDA)
    + [1-3. 분석목표 도출하기](#1-3-분석목표-도출하기)
- [2. 전처리](#2-전처리)
    + [2-1. 결측치](#2-1)
    + [2-2. 이상치](#2-2)
- [3. Feature Engineering](#3)
    + [3-1. 날짜 변수 추가하기](#3-1)
    + [3-2. 공휴일 변수 추가하기](#3-2)
    + [3-3. 수용가별 군집화하기 clustering](#3-3)
- [4. 모델링](#4)
    + [4-1. Quantile Regression](#4-1)
- [5. 결과]


# 0. 공모전 개요 

- 2018년 6월에 수자원공사에서 [2018 대국민 빅데이터 분석과제 공모전](https://www.kwater.or.kr/news/repoView.do?brdId=KO26&s_mid=36&seq=104197)에 참가

- **주최측에서 제시한 주제** : 실시간 물수요 예측

- **공모전 준비기간** : 2018.06.22 ~ 2018.07.12 (약 3주)

- **공모전 결과** : 입선  

- **구성원 역할** 
    + **김동규** : 자료검색, 보고서담당
    + **양명철** : 자료검색, 외부연락담당, 시계열 분석 
    + **임예림(본인)** : 팀장, 시각화, Quantile Regression분석, SVM분석   
    + **정수린** : PPT담당, DB구축
    + **최재훈** : 모델링, 의사결정나무 분석, 시각화

<br>

***
# 1. 분석 목표 정하기

분석 목표를 정하는 과정은 제일 어려웠던 부분 중 하나였다. <br>
반응변수와 독립변수를 무엇으로 설정해야할지....  <br>
공모전 의도와는 일치하는지.... <br> 

이를 위해 관련 전문가들을 3분 만나 인터뷰했다. <br> 
분석 목표를 정하기 위해서는 <br>
무엇을 분석 목표로 둘지 정하느라 2주 내내 고민했다. 
도대체 무엇을 분석 목표로 두어야하는가. 



#### 배운 점 1 

> 분석 목표를 잘 정하기 위해서는 **EDA**가 잘 되어있어야 한다. <br>
> **EDA**로부터 **문제상황**을 정의할 수 있고, <br>
> **문제상황**으로부터 구체적인 **분석목표**를 정할 수 있다.  <br>
> **분석목표**로부터 **분석과정**이 도출되고 <br>
> **분석과정**이 정의되어야만 그에 알맞는 **전처리**를 할 수 있다. 

<br>

## 1-1. 사용한 데이터

- **water_usage_dataset.csv** <br>
실시간 물 사용량 데이터. (약 1,600만건. 수자원 공사 제공) <br>
충남 서산시 팔봉면에서 15개월 동안 [**스마트 미터기**](http://www.sommeliertimes.com/news/articleView.html?idxno=2907)를 통해 수집했다.  <br>

- **customer_info.csv** <br>
수용가 정보 (수자원 공사 제공) <br>
각 가구별 정보 (약 1,600가구, 주소, 업종, 구경, 급수상태) <br>

- **climate.csv** <br>
강수량 & 기온 ([기상청 제공](https://data.kma.go.kr/data/rmt/rmtList.do?code=410&pgmNo=571)) <br>
강수량 및 기온이 물 사용량에 미치는 영향을 살피기 위해 사용했다. <br>
RamdomForest으로 분석할 때  사용되었다.  <br>

![데이터설명](images\variable2.PNG)  <br>
![변수설명](images\variable1.PNG)

<br>
<br>

## 1-2. EDA

데이터가 어떤 형식으로 주어졌는지 살펴보기로 했다. 


<br>

### Troubelshootings
1. 데이터 불러들이기 

엑셀을 이용해 3일동안 EDA를 했다가 엑셀에 모든 데이터가 불러들여지지 않았다는 사실을 발견했다. <br>
데이터가 너무 커서 다 불러지지 못한 것이다.  <br>
그래서 R을 통해 EDA를 새로 시작했다. <br>
원하는 변수를 추출하고, 데이터 형식으로 새로 가공하고 plot 그리는 과정이 복잡했다. 

EDA할 때 필수적인 dplyr패키지에 능숙하지 못한 구성원들이 있어서 EDA에 속도가 빠르게 붙지 않았다.  <br>
이를 해결하기 위해 EDA를 할 수 있는 기본 코드를 정리해서 각 구성원들에게 배포했다. 


2. RAM 부족문제 
**문제상황** <br>
8G램으로는 분석 소화 불가. <br>
랩 부족으로 session이 만료되는 상황발생. <br>
**해결방법** <br>
variable별로 변수를 저장하고 필요할 때만 각 변수를 불러들임
**효과** <br>
1. 램부족 현상 해결
2. 분석 도중 세션 만료되는 현상 사라짐
3. 팀원들간 데이터 전송시간 절약



<br>

#### EDA를 통해 발견한 사실들
> 1. 실시간 사용량이 평균에 비해 100배나 큰 집단이 있다. <br>
> 이 집단에 대한 적절한 대처가 있어야 평범한 대다수의 데이터의 변화를 적절하게 찾아볼 수 있다.
>  
<br>  

> 2. 

#### 배운 점 2
>  왜 visualization이 중요한지 알게 되었다. <br>
>  데이터를 다양한 각도에서 바라보면 데이터를 잘 이해하게 되고 분석 방향도 잡히게 된다. 
>  분석이 잘 되려면 EDA를 잘해야한다. 

<br>

## 1-3. 분석목표 도출하기

**수용가 구분을 통한 효과적인 물 절약 방안 제시**

물 사용 특성을 분류하고 이에 알맞는 물 사용패턴을 정리하자.  <br>
물 사용 패턴을 통해 RamdomForest와 회귀분석등을 수행해서 물 수요에 영향을 미치는 요소들을 찾아보자. 

물 수요에 영향을 미치는 요소들을 조절하면 근본적인 물 절약 방안을 제시할 수 있을거야!



<br>

*** 

# 2. 데이터 전처리 
누적 



## 2-1. 결측치 처리 
1. NA값 삭제
2. 누적사용량에 오류가 있는 값 삭제

> 누적사용량 $$\neq \sum$$ 실시간 사용량 

위와 같은 경우 삭제했음.

3. 존재하지 않는 데이터 삭제


## 2-2. 이상치 처리 

평균보다  $$\sigma$$  떨어진 값은 수정


이상치를 처리하면 어떻게 되냐면


<br>

***

# 3. Feature Engineering


<br>

*** 

# 4. 모델링 

<br>

## 4-1. Qauntile Regression

### 방법을 사용한 이유 
- 회귀가정을 만족하지 않기 때문에 
- 분포를 가정하지 않는 비모수적 방법이라서 
- 우리 데이터를 물 사용량에 따라 그 특성이 갈린다고 판단된다. 
- Quantile Regression은 각 분위마다 회귀선을 다르게 그려주기 때문에 물 사용 구간에 따른 차이를 반영할 수 있다는 **장점이 있다**. 


#### 알게 된 점 3

> 분석 모델을 짤 때는 **분석목표**와 **데이터의 특성**을 염두에 두고 만들어야 한다. <br> 
> 무작정 모든 변수를 독립변수로 추가해서는 유의미한 결과를 얻을 수 없다.  <br>
> 분석하기 전엔 일정한 **가설**을 세우고 있어야 한다. <br> 
> 그래야 원하는 결과로 더 빨리 다가갈 수 있다.  <br>
- 



<br>

***

# 5. 결과

# 5-1. 분석에서 얻은 Insight

# 5-2. 분석결과의 적용

- (주)광축과 같이 초대수용가에 대한 집중적인 물관리가 필요하다. 
이는 절연칼 사용, 절수형 호스 사용 등으로 보완할 수 있다. 


